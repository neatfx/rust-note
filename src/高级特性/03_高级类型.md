# 高级类型

## 为类型安全及抽象而使用 `Newtype` 模式

## 使用类型别名创建类型同义词

```rust
type Kilometers = i32;
```

```rust
type Kilometers = i32;

let x: i32 = 5;
let y: Kilometers = 5;

println!("x + y = {}", x + y);
```

```rust
Box<dyn Fn() + Send + 'static>
```

```rust
let f: Box<dyn Fn() + Send + 'static> = Box::new(|| println!("hi"));

fn takes_long_type(f: Box<dyn Fn() + Send + 'static>) {
    // --snip--
}

fn returns_long_type() -> Box<dyn Fn() + Send + 'static> {
    // --snip--
    Box::new(|| ())
}
```

```rust
type Thunk = Box<dyn Fn() + Send + 'static>;

let f: Thunk = Box::new(|| println!("hi"));

fn takes_long_type(f: Thunk) {
    // --snip--
}

fn returns_long_type() -> Thunk {
    // --snip--
}
```

```rust
use std::io::Error;
use std::fmt;

pub trait Write {
    fn write(&mut self, buf: &[u8]) -> Result<usize, Error>;
    fn flush(&mut self) -> Result<(), Error>;

    fn write_all(&mut self, buf: &[u8]) -> Result<(), Error>;
    fn write_fmt(&mut self, fmt: fmt::Arguments) -> Result<(), Error>;
}
```

```rust
type Result<T> = std::result::Result<T, std::io::Error>;
```

```rust
pub trait Write {
    fn write(&mut self, buf: &[u8]) -> Result<usize>;
    fn flush(&mut self) -> Result<()>;

    fn write_all(&mut self, buf: &[u8]) -> Result<()>;
    fn write_fmt(&mut self, fmt: Arguments) -> Result<()>;
}
```

## 从不返回的 `Never` 类型

```rust
fn bar() -> ! {
    // --snip--
}
```

```rust
let guess: u32 = match guess.trim().parse() {
    Ok(num) => num,
    Err(_) => continue,
};
```

```rust
let guess = match guess.trim().parse() {
    Ok(_) => 5,
    Err(_) => "hello",
}
```

```rust
impl<T> Option<T> {
    pub fn unwrap(self) -> T {
        match self {
            Some(val) => val,
            None => panic!("called `Option::unwrap()` on a `None` value"),
        }
    }
}
```

```rust
print!("forever ");

loop {
    print!("and ever ");
}
```

## 动态大小类型及 `Sized` 特质

```rust
let s1: str = "Hello there!";
let s2: str = "How's it going?";
```

```rust
fn generic<T>(t: T) {
    // --snip--
}
```

```rust
fn generic<T: Sized>(t: T) {
    // --snip--
}
```

```rust
fn generic<T: ?Sized>(t: &T) {
    // --snip--
}
```
