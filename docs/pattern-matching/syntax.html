<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>有效的模式语法 | Rust 学习笔记</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.8bcf7c97.css" as="style"><link rel="preload" href="/assets/js/app.7819f68a.js" as="script"><link rel="preload" href="/assets/js/2.c7e95d31.js" as="script"><link rel="preload" href="/assets/js/39.4ee57d9f.js" as="script"><link rel="prefetch" href="/assets/js/10.71b7f3db.js"><link rel="prefetch" href="/assets/js/11.33bb0966.js"><link rel="prefetch" href="/assets/js/12.f7bdb846.js"><link rel="prefetch" href="/assets/js/13.14713a71.js"><link rel="prefetch" href="/assets/js/14.7a72f426.js"><link rel="prefetch" href="/assets/js/15.79443f0e.js"><link rel="prefetch" href="/assets/js/16.bfb56dec.js"><link rel="prefetch" href="/assets/js/17.c67e5630.js"><link rel="prefetch" href="/assets/js/18.28df6e14.js"><link rel="prefetch" href="/assets/js/19.6dba0f6e.js"><link rel="prefetch" href="/assets/js/20.7fe96ebb.js"><link rel="prefetch" href="/assets/js/21.c1ca2b28.js"><link rel="prefetch" href="/assets/js/22.8d30fb36.js"><link rel="prefetch" href="/assets/js/23.a04d06e6.js"><link rel="prefetch" href="/assets/js/24.8f9dbc43.js"><link rel="prefetch" href="/assets/js/25.1ab69d7f.js"><link rel="prefetch" href="/assets/js/26.9892c271.js"><link rel="prefetch" href="/assets/js/27.e2eb50d5.js"><link rel="prefetch" href="/assets/js/28.31270cab.js"><link rel="prefetch" href="/assets/js/29.e5fde72d.js"><link rel="prefetch" href="/assets/js/3.065ccf56.js"><link rel="prefetch" href="/assets/js/30.80a32322.js"><link rel="prefetch" href="/assets/js/31.827d06ec.js"><link rel="prefetch" href="/assets/js/32.b74942dc.js"><link rel="prefetch" href="/assets/js/33.db15a8db.js"><link rel="prefetch" href="/assets/js/34.343562c8.js"><link rel="prefetch" href="/assets/js/35.c33e3c9f.js"><link rel="prefetch" href="/assets/js/36.61e40180.js"><link rel="prefetch" href="/assets/js/37.907cc52e.js"><link rel="prefetch" href="/assets/js/38.87af5dd2.js"><link rel="prefetch" href="/assets/js/4.4b7d39e7.js"><link rel="prefetch" href="/assets/js/40.8d7408e4.js"><link rel="prefetch" href="/assets/js/41.c2046a9f.js"><link rel="prefetch" href="/assets/js/42.6cc376da.js"><link rel="prefetch" href="/assets/js/43.63a455c5.js"><link rel="prefetch" href="/assets/js/44.0d15d778.js"><link rel="prefetch" href="/assets/js/45.9be4bc9f.js"><link rel="prefetch" href="/assets/js/46.e22e8db9.js"><link rel="prefetch" href="/assets/js/47.dbd72152.js"><link rel="prefetch" href="/assets/js/48.ec6ca506.js"><link rel="prefetch" href="/assets/js/49.22c5f8ae.js"><link rel="prefetch" href="/assets/js/5.3befbe85.js"><link rel="prefetch" href="/assets/js/50.4a58f660.js"><link rel="prefetch" href="/assets/js/51.36d42e96.js"><link rel="prefetch" href="/assets/js/52.2ec659fc.js"><link rel="prefetch" href="/assets/js/53.541947fb.js"><link rel="prefetch" href="/assets/js/54.1cf56973.js"><link rel="prefetch" href="/assets/js/55.27ed2009.js"><link rel="prefetch" href="/assets/js/56.4011a578.js"><link rel="prefetch" href="/assets/js/57.70babd7b.js"><link rel="prefetch" href="/assets/js/58.39568e0b.js"><link rel="prefetch" href="/assets/js/59.98811df6.js"><link rel="prefetch" href="/assets/js/6.fa4dd12d.js"><link rel="prefetch" href="/assets/js/60.c0a0c3f8.js"><link rel="prefetch" href="/assets/js/61.83913c6f.js"><link rel="prefetch" href="/assets/js/62.0ea87c47.js"><link rel="prefetch" href="/assets/js/7.e902d7c9.js"><link rel="prefetch" href="/assets/js/8.ac97398c.js"><link rel="prefetch" href="/assets/js/9.52c69a98.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8bcf7c97.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Rust Note</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>通用编程概念</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>所有权</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>抽象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>生命周期</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>模式匹配</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pattern-matching/intro.html" class="sidebar-link">模式匹配</a></li><li><a href="/pattern-matching/places-for-patterns.html" class="sidebar-link">应用模式的位置</a></li><li><a href="/pattern-matching/refutability.html" class="sidebar-link">模式的形式</a></li><li><a href="/pattern-matching/syntax.html" class="active sidebar-link">有效的模式语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#匹配字面值" class="sidebar-link">匹配字面值</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#匹配命名变量" class="sidebar-link">匹配命名变量</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#多个模式" class="sidebar-link">多个模式</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#通过-匹配值的范围" class="sidebar-link">通过 ... 匹配值的范围</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#解构并分解值" class="sidebar-link">解构并分解值</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#忽略模式中的值" class="sidebar-link">忽略模式中的值</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#匹配守卫提供的额外条件" class="sidebar-link">匹配守卫提供的额外条件</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#使用运算符-创建绑定" class="sidebar-link">使用运算符 @ 创建绑定</a></li><li class="sidebar-sub-header"><a href="/pattern-matching/syntax.html#遗留模式：ref-和-ref-mut" class="sidebar-link">遗留模式：ref 和 ref mut</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程范式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>高级特性</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="有效的模式语法"><a href="#有效的模式语法" class="header-anchor">#</a> 有效的模式语法</h1> <p>通过本书我们已领略过许多不同类型模式的例子。本节会统一列出所有在模式中有效的语法并且会阐述你为什么可能会希望使用其中的每一个。</p> <h2 id="匹配字面值"><a href="#匹配字面值" class="header-anchor">#</a> 匹配字面值</h2> <p>此语法用于代码得到某个具体值时进行操作</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 字面值</span>

<span class="token keyword">match</span> x <span class="token punctuation">{</span>
    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">3</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    _ <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;anything&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="匹配命名变量"><a href="#匹配命名变量" class="header-anchor">#</a> 匹配命名变量</h2> <p>命名变量是匹配任何值的不可反驳模式。当用于 <code>match</code> 表达式时情况会有些复杂，因为 <code>match</code> 会创建一个新的作用域，<code>match</code> 表达式中作为模式的一部分声明的变量会覆盖 <code>match</code> 结构外的同名变量。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> x <span class="token punctuation">{</span>
        <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Got 50&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">Some</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Matched, y = {:?}&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Default case, x = {:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;at the end: x = {:?}, y = {:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>第一个匹配分支的模式不匹配 <code>x</code> 中定义的值。</p> <p>第二个匹配分支中的模式引入了新变量 <code>y</code>，新变量 <code>y</code> 绑定会匹配任何 <code>Some</code> 中的值，该分支的表达式将会打印 <code>Matched, y = 5</code>。</p> <p>如果 <code>x</code> 的值是 <code>None</code> 而不是 <code>Some(5)</code>，前两个分支的模式不会匹配，而是会匹配下划线。该分支的模式中没有引入变量 <code>x</code>，因此表达式中的 <code>x</code> 是位于 <code>match</code> 外部没有被覆盖的变量 <code>x</code>，<code>match</code> 将会打印 <code>Default case, x = None</code>。</p> <p>一旦 <code>match</code> 表达式执行完毕，其作用域随之结束，其内部变量 <code>y</code> 的作用域也随之结束。程序会打印 <code>at the end: x = Some(5), y = 10</code>。</p> <p>为了创建能够比较外部 <code>x</code> 和 <code>y</code> 的值，而不引入覆盖变量的 <code>match</code> 表达式，需要使用带有条件的匹配守卫（ match guard ）。</p> <h2 id="多个模式"><a href="#多个模式" class="header-anchor">#</a> 多个模式</h2> <p>在 <code>match</code> 表达式中，可以使用 <code>|</code> 语法匹配多个模式，它代表 <strong>或</strong>（ <em>or</em> ）的意思：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> x <span class="token punctuation">{</span>
    <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;one or two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">3</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    _ <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;anything&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面的代码会打印 <code>one or two</code></p> <h2 id="通过-匹配值的范围"><a href="#通过-匹配值的范围" class="header-anchor">#</a> 通过 <code>...</code> 匹配值的范围</h2> <p><code>...</code> 语法允许你匹配一个闭区间范围内的值。</p> <p><code>...</code> 相比使用 <code>|</code> 运算符在表达相同的意思时更为简洁。</p> <p><code>...</code> 只允许用于数字或 <code>char</code> 值，因为编译器会在编译时检查范围不为空，而 <code>char</code> 和数字值是 Rust 唯一知道范围是否为空的类型。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> x <span class="token punctuation">{</span>
    <span class="token number">1</span> <span class="token punctuation">...</span> <span class="token number">5</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;one through five&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    _ <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;something else&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果 <code>x</code> 是 1、2、3、4 或 5，第一个分支就会匹配。</p> <p>使用 <code>char</code> 类型值范围的示例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token char string">'c'</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> x <span class="token punctuation">{</span>
    <span class="token char string">'a'</span> <span class="token punctuation">...</span> <span class="token char string">'j'</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;early ASCII letter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token char string">'k'</span> <span class="token punctuation">...</span> <span class="token char string">'z'</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;late ASCII letter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    _ <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;something else&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Rust 知道 <code>c</code> 位于第一个模式的范围内，因此会打印出 <code>early ASCII letter</code>。</p> <h2 id="解构并分解值"><a href="#解构并分解值" class="header-anchor">#</a> 解构并分解值</h2> <p>可以使用模式来解构结构体、枚举、元组和引用，以便使用这些值的不同部分。</p> <h3 id="解构结构体"><a href="#解构结构体" class="header-anchor">#</a> 解构结构体</h3> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Point <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> a<span class="token punctuation">,</span> y<span class="token punctuation">:</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代码创建了变量 <code>a</code> 和 <code>b</code> 来匹配变量 <code>p</code> 中的 <code>x</code> 和 <code>y</code> 字段。</p> <p>模式中的变量名不必与结构体中的字段名一致。不过通常希望变量名与字段名一致以便于理解变量来自于哪些字段。因为变量名匹配字段名很常见，所以还可以进行简写：只需列出结构体字段的名称，则模式创建的变量会有相同的名称。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="在部分结构体模式中使用字面值进行解构"><a href="#在部分结构体模式中使用字面值进行解构" class="header-anchor">#</a> 在部分结构体模式中使用字面值进行解构</h4> <p>这种方式不需要为所有的字段创建变量，允许在测试一些字段为特定值的同时创建其他字段的变量。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> p <span class="token punctuation">{</span>
        <span class="token comment">// 指定字段 `y` 匹配字面值 `0` 来匹配，并为字段 `x` 创建了变量 `x`</span>
        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;On the x axis at {}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定字段 `x` 匹配字面值 `0` 来匹配，并为字段 `y` 创建了变量 `y`</span>
        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;On the y axis at {}&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 未指定任何字面值，将匹配任何其他的 `Point`，并为 `x` 和 `y` 两个字段创建变量</span>
        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;On neither axis: ({}, {})&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>示例代码中的 <code>p</code> 将匹配第二个分支，因此会打印出 <code>On the y axis at 7</code>。</p> <h3 id="解构枚举"><a href="#解构枚举" class="header-anchor">#</a> 解构枚举</h3> <p>解构枚举的模式需要对应枚举所定义的数据储存方式。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">enum</span> Message <span class="token punctuation">{</span>
    Quit<span class="token punctuation">,</span>
    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>
        Message<span class="token punctuation">::</span>Quit <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;The Quit variant has no data to destructure.&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Move in the x direction {} and in the y direction {}&quot;</span><span class="token punctuation">,</span>
                x<span class="token punctuation">,</span>
                y
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Message<span class="token punctuation">::</span><span class="token function">Write</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Text message: {}&quot;</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">,</span>
        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Change the color to red {}, green {}, and blue {}&quot;</span><span class="token punctuation">,</span>
                r<span class="token punctuation">,</span>
                g<span class="token punctuation">,</span>
                b
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>代码将会打印 <code>Change the color to red 0, green 160, and blue 255</code>。</p> <p>对于像 <code>Message::Quit</code> 这样没有任何数据的枚举成员，不能进一步解构其值。只能匹配其字面值 <code>Message::Quit</code>，因此模式中没有任何变量。</p> <p>对于像 <code>Message::Move</code> 这样的类结构体枚举成员，可以采用类似于匹配结构体的模式。在成员名称后，使用大括号并列出字段变量以便将其分解以供此分支的代码使用。</p> <p>对于像 <code>Message::Write</code> 和 <code>Message::ChangeColor</code> 这样的类元组枚举成员，其模式则类似于用于解构元组的模式。模式中变量的数量必须与成员中元素的数量一致。</p> <h3 id="解构嵌套的结构体-枚举"><a href="#解构嵌套的结构体-枚举" class="header-anchor">#</a> 解构嵌套的结构体 &amp; 枚举</h3> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">enum</span> Color <span class="token punctuation">{</span>
   <span class="token function">Rgb</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">Hsv</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>
    Quit<span class="token punctuation">,</span>
    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">::</span><span class="token function">Hsv</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>
        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">::</span><span class="token function">Rgb</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Change the color to red {}, green {}, and blue {}&quot;</span><span class="token punctuation">,</span>
                r<span class="token punctuation">,</span>
                g<span class="token punctuation">,</span>
                b
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">::</span><span class="token function">Hsv</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Change the color to hue {}, saturation {}, and value {}&quot;</span><span class="token punctuation">,</span>
                h<span class="token punctuation">,</span>
                s<span class="token punctuation">,</span>
                v
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        _ <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="解构引用"><a href="#解构引用" class="header-anchor">#</a> 解构引用</h3> <p>当模式所匹配的值中包含引用时，可以通过在模式中指定 <code>&amp;</code> 来解构引用指向的值。解构引用将得到一个包含引用所指向数据的变量，而不是包含引用的变量。这在通过迭代器遍历引用时，需要使用闭包中的值而不是其引用时非常有用。</p> <p>示例遍历 <code>Vector</code> 中的 <code>Point</code> 实例引用，解构引用以及其中的结构体以便对 <code>x</code> 和 <code>y</code> 值进行计算：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Point <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> points <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>
    Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sum_of_squares<span class="token punctuation">:</span> i32 <span class="token operator">=</span> points
    <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span><span class="token operator">&amp;</span>Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token operator">|</span> x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>变量 <code>sum_of_squares</code> 的值为 135。</p> <p>如果尝试不使用 <code>&amp;</code>，直接匹配 <code>Point</code> 值，而不是 <code>Point</code> 的引用，将会得到错误，因为 <code>iter</code> 会遍历 <code>Vector</code> 中项的引用而不是值本身：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>error<span class="token punctuation">[</span>E0308<span class="token punctuation">]</span>: mismatched types
  --<span class="token operator">&gt;</span>
   <span class="token operator">|</span>
<span class="token number">14</span> <span class="token operator">|</span>         .map<span class="token punctuation">(</span><span class="token operator">|</span>Point <span class="token punctuation">{</span> x, y <span class="token punctuation">}</span><span class="token operator">|</span> x * x + y * y<span class="token punctuation">)</span>
   <span class="token operator">|</span>               ^^^^^^^^^^^^ expected <span class="token operator">&amp;</span>Point, found struct <span class="token variable"><span class="token variable">`</span>Point<span class="token variable">`</span></span>
   <span class="token operator">|</span>
   <span class="token operator">=</span> note: expected <span class="token builtin class-name">type</span> <span class="token variable"><span class="token variable">`</span><span class="token operator">&amp;</span>Point<span class="token variable">`</span></span>
              found <span class="token builtin class-name">type</span> <span class="token variable"><span class="token variable">`</span>Point<span class="token variable">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="解构结构体和元组"><a href="#解构结构体和元组" class="header-anchor">#</a> 解构结构体和元组</h3> <p>可以用复杂的方式合成、匹配和嵌套解构模式，进而将复杂的类型分解以便于单独使用其中的部分值。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>feet<span class="token punctuation">,</span> inches<span class="token punctuation">)</span><span class="token punctuation">,</span> Point <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="忽略模式中的值"><a href="#忽略模式中的值" class="header-anchor">#</a> 忽略模式中的值</h2> <p>有时忽略模式中的一些值是有用的，比如 <code>match</code> 中的最后一个分支负责捕获全部剩余情况，尽管没有做任何处理，但是它确实是有意义的。</p> <h3 id="使用-忽略整个值"><a href="#使用-忽略整个值" class="header-anchor">#</a> 使用 <code>_</code>忽略整个值</h3> <p>在函数签名中忽略参数</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">foo</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;This code only uses the y parameter: {}&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>一般来说，当不再需要某个特定函数参数时，最好是修改函数签名将其移除。但在一些特殊情况下忽略函数参数更有用，比如实现特质时，需要特定类型签名但是函数实现并不依赖某个参数时，此时编译器就不会警告说存在未使用的函数参数。</strong></p> <h3 id="使用嵌套的-忽略部分值"><a href="#使用嵌套的-忽略部分值" class="header-anchor">#</a> 使用嵌套的 <code>_</code> 忽略部分值</h3> <p>当只需要测试部分值但在期望运行的代码部分中没有使用它们时，也可以在另一个模式内部使用 <code>_</code> 来只忽略部分值。</p> <p>示例演示：</p> <ul><li>不允许覆盖已经存在的自定义配置</li> <li>允许清空已有配置</li> <li>配置不存在时可以提供新的配置</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> setting_value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> new_setting_value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> <span class="token punctuation">(</span>setting_value<span class="token punctuation">,</span> new_setting_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 分支无需匹配或使用任一 `Some` 成员的值</span>
    <span class="token comment">// 其目的在于测试 `setting_value` 和 `new_setting_value` 均为 `Some` 成员</span>
    <span class="token punctuation">(</span><span class="token function">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Can't overwrite an existing customized value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 分支匹配情况：当 `setting_value` 或 `new_setting_value` 任一为 `None`</span>
    _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 此时期望 `new_setting_value` 变为 `setting_value`</span>
        setting_value <span class="token operator">=</span> new_setting_value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;setting is {:?}&quot;</span><span class="token punctuation">,</span> setting_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>代码打将依次印 <code>Can't overwrite an existing customized value</code>、<code>setting is Some(5)</code>。</p> <h4 id="在模式中的多处使用下划线来忽略特定值"><a href="#在模式中的多处使用下划线来忽略特定值" class="header-anchor">#</a> 在模式中的多处使用下划线来忽略特定值</h4> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> numbers <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>first<span class="token punctuation">,</span> _<span class="token punctuation">,</span> third<span class="token punctuation">,</span> _<span class="token punctuation">,</span> fifth<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Some numbers: {}, {}, {}&quot;</span><span class="token punctuation">,</span> first<span class="token punctuation">,</span> third<span class="token punctuation">,</span> fifth<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>打印结果为 <code>Some numbers: 2, 8, 32</code>, 值 <code>4</code> 和 <code>16</code> 将被忽略。</p> <h3 id="以-开头命名变量进行忽略"><a href="#以-开头命名变量进行忽略" class="header-anchor">#</a> 以 <code>_</code> 开头命名变量进行忽略</h3> <p>创建变量却不使用，Rust 通常会给出警告。但很多时候创建一个暂时不使用的变量是有实际意义的，以 <code>_</code> 开头命名变量会告知 Rust 忽略此类情况，</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 不会引发警告</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 将引发变量未使用的警告</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="只使用-和使用以-开头的名称的差异"><a href="#只使用-和使用以-开头的名称的差异" class="header-anchor">#</a> 只使用 <code>_</code> 和使用以 <code>_</code> 开头的名称的差异</h4> <p><code>_x</code> 仍会将值绑定到变量，而 <code>_</code> 则完全不会绑定：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>_s<span class="token punctuation">)</span> <span class="token operator">=</span> s <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;found a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>运行得到错误，因为 <code>s</code> 的值仍然会移动进 <code>_s</code>，并阻止再次使用 <code>s</code>。</p> <p>只使用 <code>_</code> 则不会绑定值：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `s` 不会被移动进 `_`</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> s <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;found a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以正常使用 s</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="用-忽略剩余值"><a href="#用-忽略剩余值" class="header-anchor">#</a> 用 <code>..</code> 忽略剩余值</h3> <p>使用 <code>..</code> 语法可以对有多个部分的值进行部分忽略，并避免使用 <code>_</code> 匹配每一个忽略值，<code>..</code> 模式会忽略模式中剩余的任何未显式匹配的值的部分。</p> <p>在 <code>match</code> 表达式中，我们希望只操作 <code>x</code> 并忽略 <code>y</code> 和 <code>z</code> 字段的值：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Point <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
    z<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> origin <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> origin <span class="token punctuation">{</span>
    Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> _<span class="token punctuation">,</span> z<span class="token punctuation">:</span> _ <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x is {}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 使用 `_` 的写法</span>
    Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x is {}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 使用 `..` 的写法，更简单</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="会扩展为所需要的值的数量"><a href="#会扩展为所需要的值的数量" class="header-anchor">#</a> <code>..</code> 会扩展为所需要的值的数量</h4> <p>使用 <code>first</code> 和 <code>last</code> 匹配第一个和最后一个值，<code>..</code> 将匹配并忽略中间的所有值。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> numbers <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">,</span> last<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Some numbers: {}, {}&quot;</span><span class="token punctuation">,</span> first<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用 <code>..</code> 必须是无歧义的，如果期望匹配和忽略的值是不明确的，Rust 会报错：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> numbers <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">,</span> second<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Some numbers: {}&quot;</span><span class="token punctuation">,</span> second<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果编译上面的例子，会得到下面的错误：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>error: <span class="token variable"><span class="token variable">`</span><span class="token punctuation">..</span><span class="token variable">`</span></span> can only be used once per tuple or tuple struct pattern
 --<span class="token operator">&gt;</span> src/main.rs:5:22
  <span class="token operator">|</span>
<span class="token number">5</span> <span class="token operator">|</span>         <span class="token punctuation">(</span><span class="token punctuation">..</span>, second, <span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">|</span>                      ^^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="匹配守卫提供的额外条件"><a href="#匹配守卫提供的额外条件" class="header-anchor">#</a> 匹配守卫提供的额外条件</h2> <p><strong>匹配守卫</strong>（ <em>match guard</em> ）是位于 <code>match</code> 分支模式之后的额外 <code>if</code> 条件，同时满足分支模式以及匹配守卫条件才可以进入匹配分支，用于表达比单独的模式更复杂的情况。</p> <p>匹配守卫可以使用模式中创建的变量。</p> <p>代码将打印出 <code>less than five: 4</code></p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> num <span class="token punctuation">{</span>
    <span class="token comment">// 分支有模式 `Some(x)` 还有匹配守卫 `if x &lt; 5`</span>
    <span class="token comment">// 无法在模式中表达 `if x &lt; 5` 的条件，而匹配守卫提供了额外的能力</span>
    <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;less than five: {}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    None <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="使用匹配守卫来解决模式中的变量覆盖问题"><a href="#使用匹配守卫来解决模式中的变量覆盖问题" class="header-anchor">#</a> 使用匹配守卫来解决模式中的变量覆盖问题</h3> <p><code>match</code> 表达式的模式中新建了一个变量而不是使用 <code>match</code> 之外的同名变量，新变量意味着不能够测试外部变量的值。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> x <span class="token punctuation">{</span>
        <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Got 50&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 使用 Some(y) 会创建新变量 y</span>
        <span class="token comment">// 使用匹配守卫后，y不再是新建变量，而是外部变量</span>
        <span class="token function">Some</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">if</span> n <span class="token operator">==</span> y <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Matched, n = {:?}&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Default case, x = {:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;at the end: x = {:?}, y = {:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="匹配守卫与使用或运算符指定的多个模式"><a href="#匹配守卫与使用或运算符指定的多个模式" class="header-anchor">#</a> 匹配守卫与使用或运算符指定的多个模式</h3> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> x <span class="token punctuation">{</span>
    <span class="token comment">// 匹配守卫 `if y` 看起来好像只作用于 `6`，实际上作用于 `4`、`5`、`6`</span>
    <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">6</span> <span class="token keyword">if</span> y <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;yes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    _ <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>换句话说，匹配守卫与模式的优先级关系看起来像这样：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">if</span> y <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>而不是：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">4</span> <span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">6</span> <span class="token keyword">if</span> y<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果匹配守卫只作用于由 <code>|</code> 运算符指定的值列表的最后一个值，这个分支就会匹配并打印出 <code>yes</code>。</p> <h2 id="使用运算符-创建绑定"><a href="#使用运算符-创建绑定" class="header-anchor">#</a> 使用运算符 <code>@</code> 创建绑定</h2> <p>运算符 <code>@</code> 允许在创建一个存放值的变量的同时测试其值是否匹配模式。</p> <p>示例代码将会打印 <code>Found an id in range: 5</code>：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// 测试 `Message::Hello` 的 `id` 字段是否位于 `3...7` 范围内</span>
<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>
    Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> msg <span class="token punctuation">{</span>
    <span class="token comment">// 使用 `@` 可以在一个模式中同时测试和保存变量值</span>
    <span class="token comment">// 分支 1 通过在 `3...7` 之前指定 `id_variable @` 用于：</span>
    <span class="token comment">// 捕获任何匹配此范围的值、测试捕获的值匹配此范围模式、将值绑定到 `id_variable` 变量</span>
    <span class="token comment">// 分支代码可以使用变量 `id_variable`，该变量也可以命名为 `id`</span>
    Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> id_variable <span class="token operator">@</span> <span class="token number">3</span><span class="token punctuation">...</span><span class="token number">7</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Found an id in range: {}&quot;</span><span class="token punctuation">,</span> id_variable<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 分支 2 仅在模式中指定了一个范围，没有指定用于绑定 `id` 字段实际值的变量</span>
    <span class="token comment">// `id` 字段的值将会是 10、11、12</span>
    <span class="token comment">// 分支代码不能使用 `id` 字段中的值，因为没有将 `id` 的值保存进到变量</span>
    Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">...</span><span class="token number">12</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Found an id in another range&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 分支 3 指定了一个没有范围的变量</span>
    <span class="token comment">// 不能对 `id` 字段的值进行任何测试，因为任何值都会匹配本分支</span>
    <span class="token comment">// 拥有可以用于分支代码的变量 `id`，因为这里使用了结构体字段简写语法</span>
    Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Found some other id: {}&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="遗留模式：ref-和-ref-mut"><a href="#遗留模式：ref-和-ref-mut" class="header-anchor">#</a> 遗留模式：<code>ref</code> 和 <code>ref mut</code></h2> <p>以下代码：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> robot_name <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token function">Some</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Bors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> robot_name <span class="token punctuation">{</span>
    <span class="token operator">&amp;</span><span class="token function">Some</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Found a name: {}&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span>
    None <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;robot_name is: {:?}&quot;</span><span class="token punctuation">,</span> robot_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在 Rust 2015、2018 版本均不能通过编译：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>error<span class="token punctuation">[</span>E0507<span class="token punctuation">]</span>: cannot move out of <span class="token variable"><span class="token variable">`</span>robot_name.0<span class="token variable">`</span></span> <span class="token function">which</span> is behind a shared reference
 --<span class="token operator">&gt;</span> src/main.rs:5:7
  <span class="token operator">|</span>
<span class="token number">5</span> <span class="token operator">|</span> match robot_name <span class="token punctuation">{</span>
  <span class="token operator">|</span>       ^^^^^^^^^^
<span class="token number">6</span> <span class="token operator">|</span>     <span class="token operator">&amp;</span>Some<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> println<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;Found a name: {}&quot;</span>, name<span class="token punctuation">)</span>,
  <span class="token operator">|</span>     -----------
  <span class="token operator">|</span>     <span class="token operator">|</span>     <span class="token operator">|</span>
  <span class="token operator">|</span>     <span class="token operator">|</span>     data moved here
  <span class="token operator">|</span>     <span class="token operator">|</span>     move occurs because <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span> has <span class="token builtin class-name">type</span> <span class="token variable"><span class="token variable">`</span>std::string::String<span class="token variable">`</span></span>, <span class="token function">which</span> does not implement the <span class="token variable"><span class="token variable">`</span>Copy<span class="token variable">`</span></span> trait
  <span class="token operator">|</span>     help: consider removing the <span class="token variable"><span class="token variable">`</span><span class="token operator">&amp;</span><span class="token variable">`</span></span><span class="token builtin class-name">:</span> <span class="token variable"><span class="token variable">`</span>Some<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token variable">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>编译器提示无法将 <code>String</code> 从 <code>Option</code> 中移出，因为这是一个引用的 <code>Option</code>，所以是借用的。此时就需要使用 <code>ref</code> 进行处理：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> robot_name <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token function">Some</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Bors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> robot_name <span class="token punctuation">{</span>
    <span class="token comment">// 通过 `ref` 声明 “请将 `ref` 绑定到一个 `&amp;String` 上，不要尝试移动”</span>
    <span class="token comment">// 换句话说，`&amp;Some` 中的 `&amp;` 匹配的是一个引用 `&amp;Option&lt;String&gt;`</span>
    <span class="token comment">// 而 `ref` 创建了一个引用</span>
    <span class="token operator">&amp;</span><span class="token function">Some</span><span class="token punctuation">(</span><span class="token keyword">ref</span> name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Found a name: {}&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span>
    None <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;robot_name is: {:?}&quot;</span><span class="token punctuation">,</span> robot_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>ref mut</code> 类似 <code>ref</code> 不过对应的是可变引用。</p> <p>在新版 Rust 中，如果尝试对某些借用的值使用 <code>match</code>，那么所有由模式创建的绑定都会自动尝试借用，这意味着以下代码现在可以正常工作，模式部分不再需要使用 <code>&amp;</code> 以及 <code>ref</code>：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> robot_name <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token function">Some</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Bors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `&amp;Option&lt;String&gt;`</span>

<span class="token keyword">match</span> robot_name <span class="token punctuation">{</span>
    <span class="token function">Some</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Found a name: {}&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span>
    None <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;robot_name is: {:?}&quot;</span><span class="token punctuation">,</span> robot_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Rust 是向后兼容的，所以不会移除 <code>ref</code> 和 <code>ref mut</code>，它们在一些个别场景下还有用，也可能在老的代码中遇到它们。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pattern-matching/refutability.html" class="prev">模式的形式</a></span> <span class="next"><a href="/programming-paradigm/functional-language-features/closure.html">@ 闭包</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7819f68a.js" defer></script><script src="/assets/js/2.c7e95d31.js" defer></script><script src="/assets/js/39.4ee57d9f.js" defer></script>
  </body>
</html>
