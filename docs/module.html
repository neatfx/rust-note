<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Module | Rust 学习笔记</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.8bcf7c97.css" as="style"><link rel="preload" href="/assets/js/app.7819f68a.js" as="script"><link rel="preload" href="/assets/js/2.c7e95d31.js" as="script"><link rel="preload" href="/assets/js/33.db15a8db.js" as="script"><link rel="prefetch" href="/assets/js/10.71b7f3db.js"><link rel="prefetch" href="/assets/js/11.33bb0966.js"><link rel="prefetch" href="/assets/js/12.f7bdb846.js"><link rel="prefetch" href="/assets/js/13.14713a71.js"><link rel="prefetch" href="/assets/js/14.7a72f426.js"><link rel="prefetch" href="/assets/js/15.79443f0e.js"><link rel="prefetch" href="/assets/js/16.bfb56dec.js"><link rel="prefetch" href="/assets/js/17.c67e5630.js"><link rel="prefetch" href="/assets/js/18.28df6e14.js"><link rel="prefetch" href="/assets/js/19.6dba0f6e.js"><link rel="prefetch" href="/assets/js/20.7fe96ebb.js"><link rel="prefetch" href="/assets/js/21.c1ca2b28.js"><link rel="prefetch" href="/assets/js/22.8d30fb36.js"><link rel="prefetch" href="/assets/js/23.a04d06e6.js"><link rel="prefetch" href="/assets/js/24.8f9dbc43.js"><link rel="prefetch" href="/assets/js/25.1ab69d7f.js"><link rel="prefetch" href="/assets/js/26.9892c271.js"><link rel="prefetch" href="/assets/js/27.e2eb50d5.js"><link rel="prefetch" href="/assets/js/28.31270cab.js"><link rel="prefetch" href="/assets/js/29.e5fde72d.js"><link rel="prefetch" href="/assets/js/3.065ccf56.js"><link rel="prefetch" href="/assets/js/30.80a32322.js"><link rel="prefetch" href="/assets/js/31.827d06ec.js"><link rel="prefetch" href="/assets/js/32.b74942dc.js"><link rel="prefetch" href="/assets/js/34.343562c8.js"><link rel="prefetch" href="/assets/js/35.c33e3c9f.js"><link rel="prefetch" href="/assets/js/36.61e40180.js"><link rel="prefetch" href="/assets/js/37.907cc52e.js"><link rel="prefetch" href="/assets/js/38.87af5dd2.js"><link rel="prefetch" href="/assets/js/39.4ee57d9f.js"><link rel="prefetch" href="/assets/js/4.4b7d39e7.js"><link rel="prefetch" href="/assets/js/40.8d7408e4.js"><link rel="prefetch" href="/assets/js/41.c2046a9f.js"><link rel="prefetch" href="/assets/js/42.6cc376da.js"><link rel="prefetch" href="/assets/js/43.63a455c5.js"><link rel="prefetch" href="/assets/js/44.0d15d778.js"><link rel="prefetch" href="/assets/js/45.9be4bc9f.js"><link rel="prefetch" href="/assets/js/46.e22e8db9.js"><link rel="prefetch" href="/assets/js/47.dbd72152.js"><link rel="prefetch" href="/assets/js/48.ec6ca506.js"><link rel="prefetch" href="/assets/js/49.22c5f8ae.js"><link rel="prefetch" href="/assets/js/5.3befbe85.js"><link rel="prefetch" href="/assets/js/50.4a58f660.js"><link rel="prefetch" href="/assets/js/51.36d42e96.js"><link rel="prefetch" href="/assets/js/52.2ec659fc.js"><link rel="prefetch" href="/assets/js/53.541947fb.js"><link rel="prefetch" href="/assets/js/54.1cf56973.js"><link rel="prefetch" href="/assets/js/55.27ed2009.js"><link rel="prefetch" href="/assets/js/56.4011a578.js"><link rel="prefetch" href="/assets/js/57.70babd7b.js"><link rel="prefetch" href="/assets/js/58.39568e0b.js"><link rel="prefetch" href="/assets/js/59.98811df6.js"><link rel="prefetch" href="/assets/js/6.fa4dd12d.js"><link rel="prefetch" href="/assets/js/60.c0a0c3f8.js"><link rel="prefetch" href="/assets/js/61.83913c6f.js"><link rel="prefetch" href="/assets/js/62.0ea87c47.js"><link rel="prefetch" href="/assets/js/7.e902d7c9.js"><link rel="prefetch" href="/assets/js/8.ac97398c.js"><link rel="prefetch" href="/assets/js/9.52c69a98.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8bcf7c97.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Rust Note</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>项目管理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cargo.html" class="sidebar-link">开始</a></li><li><a href="/package-and-crate.html" class="sidebar-link">Packages &amp; Crates</a></li><li><a href="/module.html" class="active sidebar-link">Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/module.html#模块" class="sidebar-link">模块</a></li><li class="sidebar-sub-header"><a href="/module.html#路径" class="sidebar-link">路径</a></li><li class="sidebar-sub-header"><a href="/module.html#访问控制" class="sidebar-link">访问控制</a></li><li class="sidebar-sub-header"><a href="/module.html#将名称引入作用域" class="sidebar-link">将名称引入作用域</a></li><li class="sidebar-sub-header"><a href="/module.html#使用外部包" class="sidebar-link">使用外部包</a></li><li class="sidebar-sub-header"><a href="/module.html#使用-rust-标准库" class="sidebar-link">使用 Rust 标准库</a></li><li class="sidebar-sub-header"><a href="/module.html#通过嵌套路径精简-use-语句" class="sidebar-link">通过嵌套路径精简 use 语句</a></li><li class="sidebar-sub-header"><a href="/module.html#将所有的公有定义引入作用域" class="sidebar-link">将所有的公有定义引入作用域</a></li><li class="sidebar-sub-header"><a href="/module.html#将模块分割进不同文件" class="sidebar-link">将模块分割进不同文件</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>通用编程概念</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>所有权</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>抽象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>生命周期</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模式匹配</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程范式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>高级特性</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="module"><a href="#module" class="header-anchor">#</a> Module</h1> <p>Modules 用于组织 <code>Crate</code> 内的代码，使其具有更好的可读性及重用性，并提供访问控制。</p> <h2 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h2> <h3 id="模块嵌套"><a href="#模块嵌套" class="header-anchor">#</a> 模块嵌套</h3> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">mod</span> woodwind <span class="token punctuation">{</span>
            <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 函数体</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">mod</span> voice <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>对应的模块树：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>crate
└── sound
    ├── instrument
    │   └── woodwind
    └── voice
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>模块 <code>woodwind</code> 嵌套在 <code>instrument</code> 中，模块 <code>instrument</code> 和模块 <code>voice</code> 是模块 <code>sound</code> 的子模块，整个模块树位于隐式模块 <code>crate</code> 的 <code>root</code> 下。</p> <h2 id="路径"><a href="#路径" class="header-anchor">#</a> 路径</h2> <p>路径用于引用模块树中的项，有两种形式:</p> <ul><li>绝对路径。从 <code>crate</code> 根开始，以 <code>crate</code> 名或者字面值 <code>crate</code> 开头</li> <li>相对路径。从当前模块开始，以 <code>self</code>、<code>super</code> 或当前模块内的标识符开头</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// 模块 sound 是定义于与 main 函数相同模块树级别的模块</span>
<span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绝对路径</span>
    <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 相对路径</span>
    sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>不过以上代码不能编译：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ cargo build
   Compiling sampleproject v0.1.0 <span class="token punctuation">(</span>file:///projects/sampleproject<span class="token punctuation">)</span>
error<span class="token punctuation">[</span>E0603<span class="token punctuation">]</span>: <span class="token keyword">function</span> <span class="token variable"><span class="token variable">`</span>clarinet<span class="token variable">`</span></span> is private
  --<span class="token operator">&gt;</span> src/main.rs:11:31
   <span class="token operator">|</span>
<span class="token number">11</span> <span class="token operator">|</span>     crate::sound::instrument::clarinet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">|</span>                               ^^^^^^^^

error<span class="token punctuation">[</span>E0603<span class="token punctuation">]</span>: <span class="token keyword">function</span> <span class="token variable"><span class="token variable">`</span>clarinet<span class="token variable">`</span></span> is private
  --<span class="token operator">&gt;</span> src/main.rs:14:24
   <span class="token operator">|</span>
<span class="token number">14</span> <span class="token operator">|</span>     sound::instrument::clarinet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">|</span>                        ^^^^^^^^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>此问题留到后面 “访问控制” 部分解决。</p> <h3 id="使用-super-开始相对路径"><a href="#使用-super-开始相对路径" class="header-anchor">#</a> 使用 <code>super</code> 开始相对路径</h3> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token function">breathe_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">breathe_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 函数体</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>模块增加嵌套后，使用 <code>super</code> 开始的相对路径函数调用不受影响：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token function">breathe_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">breathe_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 函数体</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="访问控制"><a href="#访问控制" class="header-anchor">#</a> 访问控制</h2> <p>模块是 Rust 中的私有性边界（ privacy boundary ）。如果希望函数或结构体私有，将其放入模块即可。</p> <h3 id="私有性规则"><a href="#私有性规则" class="header-anchor">#</a> 私有性规则</h3> <ul><li>所有项（函数、方法、结构体、枚举、模块和常量）默认是私有的</li> <li>可以使用 <code>pub</code> 关键字使项变为公有</li> <li>不允许使用定义于当前模块的子模块中的私有代码</li> <li>允许使用任何定义于父模块或当前模块中的代码</li></ul> <p>类似于文件系统的权限：如果没有某个目录的权限，则无法从父目录中查看其内容。如果有该目录的权限，则可以查看其中的目录和任何父目录</p> <h3 id="使用-pub-关键字使项变为公有"><a href="#使用-pub-关键字使项变为公有" class="header-anchor">#</a> 使用 <code>pub</code> 关键字使项变为公有</h3> <p>修正 “路径” 部分的示例代码，先使私有模块 <code>instrument</code> 变为公有模块：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// 模块 sound 是定义于与 main 函数相同模块树级别的模块</span>
<span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绝对路径</span>
    <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 相对路径</span>
    sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>编译仍然无法通过：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ cargo build
   Compiling sampleproject v0.1.0 <span class="token punctuation">(</span>file:///projects/sampleproject<span class="token punctuation">)</span>
error<span class="token punctuation">[</span>E0603<span class="token punctuation">]</span>: <span class="token keyword">function</span> <span class="token variable"><span class="token variable">`</span>clarinet<span class="token variable">`</span></span> is private
  --<span class="token operator">&gt;</span> src/main.rs:11:31
   <span class="token operator">|</span>
<span class="token number">11</span> <span class="token operator">|</span>     crate::sound::instrument::clarinet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">|</span>                               ^^^^^^^^

error<span class="token punctuation">[</span>E0603<span class="token punctuation">]</span>: <span class="token keyword">function</span> <span class="token variable"><span class="token variable">`</span>clarinet<span class="token variable">`</span></span> is private
  --<span class="token operator">&gt;</span> src/main.rs:14:24
   <span class="token operator">|</span>
<span class="token number">14</span> <span class="token operator">|</span>     sound::instrument::clarinet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">|</span>                        ^^^^^^^^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>模块的 <code>pub</code> 关键字只是允许其父模块引用它，模块公有并不代表其内容也是公有的。因此还需要在私有的 <code>clarinet</code> 函数前增加 <code>pub</code> 关键字使其变为公有函数：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// 模块 sound 是定义于与 main 函数相同模块树级别的模块</span>
<span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绝对路径</span>
    <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 相对路径</span>
    sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>注意：模块 <code>sound</code> 是定义于与 <code>main</code> 函数相同模块树级别的模块（ 两者共同定义于 <code>crate</code> 模块的 <code>root</code> ），可以从 <code>main</code> 中访问 <code>sound</code> 模块，尽管 <code>sound</code> 模块不是公有的。</p> <h3 id="使用-pub-定义结构体"><a href="#使用-pub-定义结构体" class="header-anchor">#</a> 使用 <code>pub</code> 定义结构体</h3> <p>在结构体定义中使用 <code>pub</code>，可以使结构体公有，不过结构体的字段仍是私有的。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> plant <span class="token punctuation">{</span>
    <span class="token comment">// 公有结构体</span>
    <span class="token keyword">pub</span> <span class="token keyword">struct</span> Vegetable <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> name<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token comment">// 公有字段</span>
        id<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> <span class="token comment">// 私有字段</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">impl</span> Vegetable <span class="token punctuation">{</span>
        <span class="token comment">// 公有关联函数</span>
        <span class="token comment">// 因为私有字段的原因，只有通过该公有关联函数才可以创建 Vegetable 示例</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Vegetable <span class="token punctuation">{</span>
            Vegetable <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> plant<span class="token punctuation">::</span>Vegetable<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&quot;squash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    v<span class="token punctuation">.</span>name <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;butternut squash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} are delicious&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果将如下行取消注释代码将无法编译:</span>
    <span class="token comment">// println!(&quot;The ID is {}&quot;, v.id);</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="使用-pub-定义枚举"><a href="#使用-pub-定义枚举" class="header-anchor">#</a> 使用 <code>pub</code> 定义枚举</h3> <p>在枚举定义中使用 <code>pub</code>，其所有枚举成员都将成为公有。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> menu <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> Appetizer <span class="token punctuation">{</span>
        Soup<span class="token punctuation">,</span>
        Salad<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> order1 <span class="token operator">=</span> menu<span class="token punctuation">::</span>Appetizer<span class="token punctuation">::</span>Soup<span class="token punctuation">;</span>
    <span class="token keyword">let</span> order2 <span class="token operator">=</span> menu<span class="token punctuation">::</span>Appetizer<span class="token punctuation">::</span>Salad<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="将名称引入作用域"><a href="#将名称引入作用域" class="header-anchor">#</a> 将名称引入作用域</h2> <h3 id="使用-use-关键字将模块引入作用域"><a href="#使用-use-关键字将模块引入作用域" class="header-anchor">#</a> 使用 <code>use</code> 关键字将模块引入作用域</h3> <p>注意：通过 <code>use</code> 引入作用域的路径也会检查私有性。</p> <h4 id="绝对路径"><a href="#绝对路径" class="header-anchor">#</a> 绝对路径</h4> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">;</span> <span class="token comment">// 绝对路径</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>移动调用项的代码时绝对路径无需移动:</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">mod</span> performance_group <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">;</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet_trio</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    performance_group<span class="token punctuation">::</span><span class="token function">clarinet_trio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="相对路径"><a href="#相对路径" class="header-anchor">#</a> 相对路径</h4> <p><strong>指定 <code>use</code> 后以 <code>self</code> 开头的相对路径在未来可能不是必须的。</strong></p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">use</span> <span class="token keyword">self</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">;</span> <span class="token comment">// 相对路径</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>选择采用相对或绝对路径能否减少代码修改取决于模块树如何变化，因为定义和调用项的代码更有可能相互独立的在模块树中移动，所以选择绝对路径可能更加适用。</p> <h3 id="推荐使用习惯"><a href="#推荐使用习惯" class="header-anchor">#</a> 推荐使用习惯</h3> <h4 id="通过-use-指定函数的父模块接着指定父模块来调用方法"><a href="#通过-use-指定函数的父模块接着指定父模块来调用方法" class="header-anchor">#</a> 通过 <code>use</code> 指定函数的父模块接着指定父模块来调用方法</h4> <p>不好的写法：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span>clarinet<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>推荐写法：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">mod</span> performance_group <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">;</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet_trio</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="通过-use-指定结构体、枚举和其它项的全路径"><a href="#通过-use-指定结构体、枚举和其它项的全路径" class="header-anchor">#</a> 通过 <code>use</code> 指定结构体、枚举和其它项的全路径</h4> <p>不好的写法：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> map <span class="token operator">=</span> collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>推荐写法：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> map <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="将两个同名类型引入作用域时使用父模块"><a href="#将两个同名类型引入作用域时使用父模块" class="header-anchor">#</a> 将两个同名类型引入作用域时使用父模块</h4> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">;</span>
<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">function1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> fmt<span class="token punctuation">::</span>Result <span class="token punctuation">{</span>
#     <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function">function2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> io<span class="token punctuation">::</span>Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
#     <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果指定 <code>use std::fmt::Result</code> 和 <code>use std::io::Result</code>，则作用域中会有两个 <code>Result</code> 类型，Rust 将无法确定使用哪一个。</p> <h3 id="重命名引入作用域的类型"><a href="#重命名引入作用域的类型" class="header-anchor">#</a> 重命名引入作用域的类型</h3> <p>将两个同名类型引入同一作用域还有一个解决办法：通过在 <code>use</code> 后加上 <code>as</code> 和一个新名称来为此类型指定一个新的本地名称。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Result<span class="token punctuation">;</span>
<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">::</span>Result <span class="token keyword">as</span> IoResult<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">function1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Result <span class="token punctuation">{</span>
#     <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function">function2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> IoResult<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
#     <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="重新导出名称"><a href="#重新导出名称" class="header-anchor">#</a> 重新导出名称</h3> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">mod</span> sound <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数体</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">mod</span> performance_group <span class="token punctuation">{</span>
    <span class="token comment">// 导入 sound::instrument 后作为 performance_group::instrument 导出</span>
    <span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">;</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet_trio</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过模块自有方法间接调用 sound::instrument::clarinet</span>
    performance_group<span class="token punctuation">::</span><span class="token function">clarinet_trio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用重新导出的路径 sound::instrument::clarinet 调用</span>
    performance_group<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="使用外部包"><a href="#使用外部包" class="header-anchor">#</a> 使用外部包</h2> <p>首先在 <code>Cargo.toml</code> 中加入依赖项，Cargo 将从 <a href="https://crates.io" target="_blank" rel="noopener noreferrer">crates.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 下载 <code>rand</code> 及其依赖并使其可用：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>dependencies<span class="token punctuation">]</span>
rand <span class="token operator">=</span> <span class="token string">&quot;0.5.5&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后引入依赖并使用：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> rand<span class="token punctuation">::</span>Rng<span class="token punctuation">;</span> <span class="token comment">// 将 Rng 特质引入作用域</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> secret_number <span class="token operator">=</span> rand<span class="token punctuation">::</span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gen_range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="使用-rust-标准库"><a href="#使用-rust-标准库" class="header-anchor">#</a> 使用 Rust 标准库</h2> <p>相对于用户 <code>package</code> 来说 Rust 标准库也是外部包。只是其跟随 Rust 语言一同分发，因此无需通过配置 <code>Cargo.toml</code> 引入，但是仍需要通过 <code>use</code> 将标准库中的项引入项目包的作用域：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="通过嵌套路径精简-use-语句"><a href="#通过嵌套路径精简-use-语句" class="header-anchor">#</a> 通过嵌套路径精简 <code>use</code> 语句</h2> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span>Ordering<span class="token punctuation">;</span>
<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以改进为：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span><span class="token punctuation">{</span>cmp<span class="token punctuation">::</span>Ordering<span class="token punctuation">,</span> io<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// 将 std::io 和 std::io::Write 同时引入作用域</span>
<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">;</span>
<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">::</span>Write<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以改进为：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">::</span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> Write<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="将所有的公有定义引入作用域"><a href="#将所有的公有定义引入作用域" class="header-anchor">#</a> 将所有的公有定义引入作用域</h2> <p>通过在路径后指定 <code>*</code>（ glob 运算符 ），可以将一个路径下的所有公有项引入作用域：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// 将 std::collections 中定义的所有公有项引入当前作用域</span>
<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这种方式的缺点在于难以推导作用域中有什么名称以及它们是在何处定义的。</p> <p><code>glob</code> 运算符常用于测试模块 <code>tests</code> 中，将所有内容引入作用域；有时也用于 <code>prelude</code> 模式。</p> <h2 id="将模块分割进不同文件"><a href="#将模块分割进不同文件" class="header-anchor">#</a> 将模块分割进不同文件</h2> <p>随着代码增长可以将模块移动到独立的文件中，当模块变得更复杂时，可将其定义拆分移动到单独的文件中，使代码更容易阅读。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// src/main.rs</span>

<span class="token comment">// 声明 sound 模块，其内容位于 src/sound.rs 文件</span>
<span class="token comment">// 使用分号而不是代码块告诉 Rust 在另一个与模块同名的文件中加载模块的内容</span>
<span class="token keyword">mod</span> sound<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绝对路径</span>
    <span class="token keyword">crate</span><span class="token punctuation">::</span>sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 相对路径</span>
    sound<span class="token punctuation">::</span>instrument<span class="token punctuation">::</span><span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// src/sound.rs</span>

<span class="token comment">// 声明 instrument 模块，其内容位于 src/sound/instrument.rs 文件</span>
<span class="token comment">// 使用分号而不是代码块告诉 Rust 在另一个与模块同名的文件中加载模块的内容</span>
<span class="token keyword">pub</span> <span class="token keyword">mod</span> instrument<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// src/sound/instrument.rs</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">clarinet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 函数体</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/package-and-crate.html" class="prev">Packages &amp; Crates</a></span> <span class="next"><a href="/variable.html">变量与可变性</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7819f68a.js" defer></script><script src="/assets/js/2.c7e95d31.js" defer></script><script src="/assets/js/33.db15a8db.js" defer></script>
  </body>
</html>
